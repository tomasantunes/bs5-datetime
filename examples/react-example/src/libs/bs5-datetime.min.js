const DEFAULTS={format:"YYYY-MM-DD HH:mm",showTime:!0,showSeconds:!1,use24Hour:!0,startDay:1};function pad(e,t=2){return String(e).padStart(t,"0")}function formatDate(e,t){const n=e.getFullYear(),a=pad(e.getMonth()+1),o=pad(e.getDate()),s=pad(e.getHours()),r=pad(e.getMinutes());return"YYYY-MM-DD HH:mm"===t.format?`${n}-${a}-${o} ${s}:${r}`:"YYYY-MM-DD"===t.format?`${n}-${a}-${o}`:"DD/MM/YYYY HH:mm"===t.format?`${o}/${a}/${n} ${s}:${r}`:"DD/MM/YYYY"===t.format?`${o}/${a}/${n}`:`${n}-${a}-${o} ${s}:${r}`}function parseInputToDate(e,t={}){if(!e)return null;const n=t.format||"YYYY-MM-DD HH:mm";let a,o,s,r,d=0,l=0;switch(n){case"YYYY-MM-DD HH:mm":a=/^(\d{4})-(\d{1,2})-(\d{1,2})[ T](\d{1,2}):(\d{1,2})$/;break;case"YYYY-MM-DD":a=/^(\d{4})-(\d{1,2})-(\d{1,2})$/;break;case"DD/MM/YYYY HH:mm":a=/^(\d{1,2})\/(\d{1,2})\/(\d{4})[ T]?(\d{1,2}):(\d{1,2})$/;break;case"DD/MM/YYYY":a=/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;break;default:throw new Error(`Unsupported date format: ${n}`)}const i=e.match(a);if(!i)return null;n.startsWith("YYYY")?(o=Number(i[1]),s=Number(i[2])-1,r=Number(i[3]),i[4]&&(d=Number(i[4])),i[5]&&(l=Number(i[5]))):(r=Number(i[1]),s=Number(i[2])-1,o=Number(i[3]),i[4]&&(d=Number(i[4])),i[5]&&(l=Number(i[5])));const u=new Date(o,s,r,d,l,0,0);return isNaN(u.getTime())?null:u}function createTemplate(){if(document.getElementById("dtp-template"))return;const e=document.createElement("template");e.id="dtp-template",e.innerHTML=`\n      <div class="dtp-popup shadow rounded" role="dialog" aria-modal="false">\n          <div class="dtp-header d-flex justify-content-between align-items-center p-2 border-bottom">\n              <div class="dtp-month-year fs-6 fw-semibold"></div>\n              <div class="dtp-nav">\n              <button type="button" class="btn btn-sm dtp-prev" aria-label="${window.previousMonth}">‹</button>\n              <button type="button" class="btn btn-sm dtp-next" aria-label="${window.nextMonth}">›</button>\n              </div>\n          </div>\n\n          <div class="dtp-calendar p-2">\n              <div class="dtp-weekdays d-flex small text-muted"></div>\n              <div class="dtp-days d-flex flex-wrap"></div>\n          </div>\n\n          <div class="p-2 border-top d-flex">\n              <div class="dtp-time d-flex gap-2 align-items-center">\n                  <label class="mb-0 small">${window.time}</label>\n                  <input type="number" class="form-control form-control-sm dtp-hour" min="0" max="23" inputmode="numeric" aria-label="${window.hours}" style="width:4.5rem">\n                  <span>:</span>\n                  <input type="number" class="form-control form-control-sm dtp-minute" min="0" max="59" inputmode="numeric" aria-label="${window.minutes}" style="width:4.5rem">\n              </div>\n              <div class="ms-auto p-2">\n                  <button class="btn btn-sm btn-primary dtp-apply">${window.apply}</button>\n              </div>\n          </div>\n      </div>\n  `,document.body.appendChild(e)}function createDatetimePicker(e,t,n,a={}){const o=Object.assign({},DEFAULTS,a),s=document.getElementById("dtp-template");if(!s)throw new Error("Template not found");console.log("Options:",o);let r=null,d=null,l=null;function i(){r=s.content.firstElementChild.cloneNode(!0),document.body.appendChild(r),r.style.display="none",r._monthYear=r.querySelector(".dtp-month-year"),r._weekdays=r.querySelector(".dtp-weekdays"),r._days=r.querySelector(".dtp-days"),r._prev=r.querySelector(".dtp-prev"),r._next=r.querySelector(".dtp-next"),r._hour=r.querySelector(".dtp-hour"),r._minute=r.querySelector(".dtp-minute"),r._apply=r.querySelector(".dtp-apply"),r._prev.addEventListener("click",()=>{d.setMonth(d.getMonth()-1),u()}),r._next.addEventListener("click",()=>{d.setMonth(d.getMonth()+1),u()}),r._apply.addEventListener("click",g),r.addEventListener("keydown",t=>{"Escape"===t.key&&(h(),e.focus())}),setTimeout(()=>{window.addEventListener("click",b)},0),function(){const e=window.weekDays;r._weekdays.innerHTML="";for(let t=0;t<7;t++){const n=(o.startDay+t)%7,a=document.createElement("div");a.className="dtp-weekday flex-fill text-center",a.textContent=e[n],r._weekdays.appendChild(a)}}()}function u(){const e=window.monthNames,t=d.getMonth(),n=e[t],a=d.getFullYear();r._monthYear.textContent=`${n} ${a}`;let s=(new Date(a,t,1).getDay()-o.startDay+7)%7;const i=new Date(a,t,1-s);r._days.innerHTML="";for(let e=0;e<42;e++){const t=new Date(i.getFullYear(),i.getMonth(),i.getDate()+e),a=document.createElement("button");a.type="button",a.className="dtp-day btn btn-sm",a.style.width="14.28%",a.style.borderRadius="0.35rem",a.setAttribute("data-date",t.toISOString()),a.textContent=t.getDate(),t.getMonth()!==n&&a.classList.add("dtp-other-month","text-muted"),l&&m(t,l)&&a.classList.add("active"),c(t)&&a.classList.add("dtp-today"),a.addEventListener("click",e=>{e.stopPropagation(),p(t)}),r._days.appendChild(a)}l?(r._hour.value=l.getHours(),r._minute.value=l.getMinutes()):(r._hour.value=d.getHours(),r._minute.value=d.getMinutes())}function c(e){const t=new Date;return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}function m(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function p(e){const t=l?l.getHours():d.getHours(),n=l?l.getMinutes():d.getMinutes();l=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t,n,0,0),u()}function g(){const t=y(Number(r._hour.value),0,23),a=y(Number(r._minute.value),0,59);l||(l=new Date(d.getFullYear(),d.getMonth(),d.getDate(),t,a,0,0)),l.setHours(t,a,0,0),e.value=formatDate(l,o),n&&n(e.value),e.dispatchEvent(new Event("change",{bubbles:!0})),h()}function y(e,t,n){return isNaN(e)?t:Math.max(t,Math.min(n,e))}function w(){r||i();const t=parseInputToDate(e.value,o);l=t||l||new Date,d=new Date(l.getFullYear(),l.getMonth(),1,l.getHours(),l.getMinutes()),u(),function(){const t=e.getBoundingClientRect(),n=r.getBoundingClientRect(),a=window.scrollY||window.pageYOffset,o=window.scrollX||window.pageXOffset,s=window.innerHeight-t.bottom;let d=t.bottom+a+6;s<n.height+10&&(d=t.top+a-n.height-6);let l=t.left+o;l=Math.max(6,Math.min(l,document.documentElement.clientWidth-n.width-6)),r.style.position="absolute",r.style.top=`${d}px`,r.style.left=`${l}px`,r.style.zIndex=1080}(),r.style.display="block",r.classList.add("show"),r.querySelector(".dtp-hour").focus(),o.showTime||(console.log("hiding time"),r.querySelector(".dtp-time").setAttribute("style","display:none !important"))}function h(){r&&(r.style.display="none",r.classList.remove("show"))}function b(t){r&&"none"!==r.style.display&&(t.target===e||e.contains(t.target)||r.contains(t.target)||t.target===document.getElementById("dtpToggle")||h())}e.addEventListener("input",t=>{const a=parseInputToDate(e.value,o);a&&(l=a),n&&n(e.value)});const f={open:w,close:h,getDate:()=>l,setDate:t=>{t instanceof Date||(t=parseInputToDate(t,o)),l=t,e.value=l?formatDate(l,o):"",n&&n(e.value)},destroy:()=>{r&&(r.remove(),r=null),e.removeEventListener("focus",w),window.removeEventListener("click",b)}};return t&&t.addEventListener("click",e=>{e.stopPropagation(),r&&"block"===r.style.display?h():w()}),e.addEventListener("keydown",t=>{if(w(),e.focus(),""==e.value&&h(),"Escape"===t.key&&h(),"Enter"===t.key){const t=parseInputToDate(e.value,o);t&&(l=t,e.value=formatDate(t,o),e.dispatchEvent(new Event("change",{bubbles:!0})),n&&n(e.value)),h()}}),f}window.createDatetimeTemplate=createTemplate,window.createDatetimePicker=createDatetimePicker;